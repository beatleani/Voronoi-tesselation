% Assignment - 8 : Digital Microstructure - 25/10/2018
% Written by Anirrudh Ramesh, MM16B014, 09:34 AM
x_max = input('Enter the size of the grid\n');
no_nuclei=input('Enter the number of nuclei: \n');
v_x=input('Enter growth velocity in x direction: \n');
v_y=input('Enter growth velocity in y direction: \n');
time = input('Enter the frequency\n');
y_max = x_max; 
n = x_max;
grain_id = zeros(n,n);
pos = zeros(no_nuclei,2);
pos2 = zeros(no_nuclei*9,3);
for t=1:no_nuclei
  x_rand = rand()*1e05;
  y_rand = rand()*1e05;
  x1 = mod(round(x_rand),x_max)+1;
  y1 = mod(round(y_rand),y_max)+1;
  grain_id(x1,y1) = t;
  pos(t,1)= x1;
  pos(t,2)= y1;
end
tot_no_nuclei = no_nuclei*9;  
counter = 1;
for i = 1 : no_nuclei
    for j = -1 : 1
        for k = -1 : 1
            pos2(counter,1) = i;
            t1 = pos(i,1)+(n*k);
            t2 = pos(i,2)+(n*j);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
            pos2(counter,2) = t1;
            pos2(counter,3) = t2; 
            counter = counter + 1;
        end 
    end
end
for i = 1 : n
    for j = 1 : n
        ref_dist = 8*n^2;
        for k = 1 : tot_no_nuclei
            distance=(((i - pos2(k,2))/(v_x*time)).^2) + ...
                     (((j - pos2(k,3))/(v_y*time)).^2);
            if(ref_dist > distance)
			 ref_dist = distance;
             grain_id(i,j) = pos2(k,1);
            end
        end
    end
end
imagesc(grain_id);
title('Generation of a 2D digital microstructure');